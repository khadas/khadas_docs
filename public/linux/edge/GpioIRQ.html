<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8">
  <title>How To Test GPIO IRQ | Khadas Documentation</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://docs.khadas.com/edge/GpioIRQ.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://docs.khadas.com/edge/GpioIRQ.html">
    
      <link rel="alternative" hreflang="zh-cn" href="https://docs.khadas.com/zh-cn/edge/GpioIRQ.html">
    
  
  <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
  <link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
  <style>
    .pace .pace-progress {
       background: #1E92FB;
       height: 2px;
     }
    .pace .pace-progress-inner {
       box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB;
     }
    .pace .pace-activity {
       border-top-color: #1E92FB;
       border-left-color: #1E92FB;
    }
  </style>
  <!-- Icon -->
  <link rel="Shortcut Icon" href="/linux/images/favicon.ico">
  <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="/linux//vendor/semantic/dist/semantic.min.css">
  <link rel="stylesheet" type="text/css" href="/linux//vendor/bootstrap-4.0.0/dist/css/bootstrap.min.css">
  <script
    src="https://s3.pstatp.com/cdn/expire-1-M/jquery/3.3.1/jquery.min.js"
    crossorigin="anonymous"></script>
  <script src="/linux//vendor/semantic/dist/semantic.min.js"></script>
  <script src="/linux//vendor/bootstrap-4.0.0/dist/js/bootstrap.bundle.min.js"></script>
 <!-- Hotjar Tracking Code for https://docs.khadas.com -->
  <script>
      (function(h,o,t,j,a,r){
          h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
          h._hjSettings={hjid:1081538,hjsv:6};
          a=o.getElementsByTagName('head')[0];
          r=o.createElement('script');r.async=1;
          r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
          a.appendChild(r);
      })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>

  <!-- build:css build/css/navy.css -->
  
<link rel="stylesheet" href="/linux/css/navy.css">

  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/linux//css/font/fontawesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/linux/atom.xml" title="Khadas Documentation" type="application/atom+xml">
  <!-- Open Graph -->
  <meta name="description" content="Switch to root userOnly root user can control GPIO, you need to switch to root user before testing. 123$ khadas@Khadas:~$ suPassword: root@Khadas:&#x2F;home&#x2F;khadas#  GPIO Pin Control Setting Confirm the pi">
<meta property="og:type" content="website">
<meta property="og:title" content="How To Test GPIO IRQ">
<meta property="og:url" content="https://docs.khadas.com/edge/GpioIRQ">
<meta property="og:site_name" content="Khadas Documentation">
<meta property="og:description" content="Switch to root userOnly root user can control GPIO, you need to switch to root user before testing. 123$ khadas@Khadas:~$ suPassword: root@Khadas:&#x2F;home&#x2F;khadas#  GPIO Pin Control Setting Confirm the pi">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-07-28T10:17:22.975Z">
<meta property="article:modified_time" content="2021-07-28T10:17:22.975Z">
<meta property="article:author" content="Khadas">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="khadas_official">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-110196417-1', 'auto');
  ga('send', 'pageview');
</script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <header id="header" class="header-wrapper">
  <div id="header-inner" class="inner wrapper">
    <h1 id="logo-wrap">
      <a href="/" id="logo">Hexo</a>
    </h1>
    <nav id="main-nav">
      <div style="display:inline-block"><div class="btn-group"><div class="main-nav-link dropdown-toggle " data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">VIM</div><ul class="dropdown-menu submenu-list" aria-labelledby="dropdownMenuLink"><li class="submenu"><a href="/linux/vim1/" class="main-nav-link secondary ">VIM1</a></li><li class="submenu"><a href="/linux/vim2/" class="main-nav-link secondary ">VIM2</a></li><li class="submenu"><a href="/linux/vim3/" class="main-nav-link secondary ">VIM3</a></li></ul></div><a href="/linux/edge/" class="main-nav-link current header">Edge</a><a href="/linux/tone1/" class="main-nav-link  header">Tone1</a><a href="/linux/hardware/hardwareEdge" class="main-nav-link  header">Hardware</a><a href="/linux/firmware/EdgeUbuntuFirmware" class="main-nav-link  header">Firmware</a></div>
      <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/khadas" class="main-nav-link"><i class="fa fa-github-alt"></i></a>
      <div id="search-input-wrap">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <div id="lang-select-wrap">
      <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
      <select id="lang-select" data-canonical="edge/GpioIRQ.html">
        
          <option value="en" selected>English</option>
        
          <option value="zh-cn">简体中文</option>
        
      </select>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner inner-article">
              <header class="article-header">
                <h1 class="article-title" itemprop="name">How To Test GPIO IRQ</h1>
                <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/khadas/khadas_docs/edit/master/source/edge/GpioIRQ.md" class="article-edit-link" title="Improve this doc"><i class="fa fa-pencil"></i></a>
              </header>
              <div class="article-content" itemprop="articleBody">
                <h2 id="Switch-to-root-user" class="article-heading"><a href="#Switch-to-root-user" class="headerlink" title="Switch to root user"></a>Switch to root user<a class="article-anchor" href="#Switch-to-root-user" aria-hidden="true"></a></h2><p>Only root user can control GPIO, you need to switch to root user before testing.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> khadas@Khadas:~$ su</span></span><br><span class="line">Password: </span><br><span class="line">root@Khadas:/home/khadas#</span><br></pre></td></tr></table></figure>

<h2 id="GPIO-Pin-Control-Setting" class="article-heading"><a href="#GPIO-Pin-Control-Setting" class="headerlink" title="GPIO Pin Control Setting"></a>GPIO Pin Control Setting<a class="article-anchor" href="#GPIO-Pin-Control-Setting" aria-hidden="true"></a></h2><ul>
<li>Confirm the pins you need to use, take VIM3 as an example:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@Khadas:/home/khadas# gpio readall</span><br><span class="line"> +------+-----+-------------------+------+---+----+--- Model  Khadas-Edge ---+----+---+------+----------------------------+-----+------+</span><br><span class="line"> | GPIO | wPi |        Name       | Mode | V | DS | PU/PD | Physical | PU/PD | DS | V | Mode |            Name            | wPi | GPIO |</span><br><span class="line"> +------+-----+-------------------+------+---+----+-------+----++----+-------+----+---+------+----------------------------+-----+------+</span><br><span class="line"> |      |     |                5V |      |   |    |       |  1 || 21 |       |    |   |      | GND(0V)                    |     |      |</span><br><span class="line"> |      |     |                5V |      |   |    |       |  2 || 22 |       |    | 1 | IN   | SPI3_RXD/I2C0_SCK/GPIO1_C0 | 4   |  48  |</span><br><span class="line"> |      |     |          HOST1_DM |      |   |    |       |  3 || 23 |       |    | 1 | IN   | SPI3_TXD/I2C0_SDA/GPIO1_B7 | 5   |  47  |</span><br><span class="line"> |      |     |          HOST1_DP |      |   |    |       |  4 || 24 |       |    |   |      | GND(0V)                    |     |      |</span><br><span class="line"> |      |     |           GND(0V) |      |   |    |       |  5 || 25 |       |    | 1 | IN   | I2C2_SCL/GPIO2_A1          | 6   |  65  |</span><br><span class="line"> |      |     |            MCU_TX |      |   |    |       |  6 || 26 |       |    | 1 | IN   | I2C2_SDA/GPIO2_A0          | 7   |  64  |</span><br><span class="line"> |      |     |          MCU_NRST |      |   |    |       |  7 || 27 |       |    |   |      | 3.3V                       |     |      |</span><br><span class="line"> |      |     |          MCU_SWIM |      |   |    |       |  8 || 28 |       |    |   |      | GND(0V)                    |     |      |</span><br><span class="line"> |      |     |           GND(0V) |      |   |    |       |  9 || 29 |       |    | 0 | ALT0 | I2S0_SCLK/GPIO3_D0         | 8   |  120 |</span><br><span class="line"> |      |     |           ADC_IN2 |      |   |    |       | 10 || 30 |       |    | 0 | ALT0 | I2S_CLK/GPIO4_A0           | 9   |  128 |</span><br><span class="line"> |      |     |              1.8V |      |   |    |       | 11 || 31 |       |    | 0 | ALT0 | I2S0_SDO0/GPIO3_D7         | 10  |  127 |</span><br><span class="line"> |      |     |           ADC_IN3 |      |   |    |       | 12 || 32 |       |    | 0 | ALT0 | 2S0_LRCK_TX/GPIO3_D2       | 11  |  122 |</span><br><span class="line"> |  112 |   1 |    SPDIF/GPIO3_C0 |   IN | 1 |    |       | 13 || 33 |       |    | 0 | ALT0 | I2S0_SDI0/GPIO3_D3         | 12  |  123 |</span><br><span class="line"> |      |     |            GND(0V |      |   |    |       | 14 || 34 |       |    |   |      | GND(0V)                    |     |      |</span><br><span class="line"> |   50 |   2 |  SPI3_CS/GPIO1_C2 |   IN | 1 |    |       | 15 || 35 |       |    | 0 | ALT0 | I2S0_SDI3SDO1/GPIO3_D6     | 13  |  126 |</span><br><span class="line"> |   49 |   3 | SPI3_CLK/GPIO1_C1 |   IN | 0 |    |       | 16 || 36 |       |    | 0 | ALT0 | 2S0_SDI2SDO2/GPIO3_D5      | 14  |  125 |</span><br><span class="line"> |      |     |           GND(0V) |      |   |    |       | 17 || 37 |       |    | 0 | ALT0 | I2S0_SDI1SDO3/GPIO3_D4     | 15  |  124 |</span><br><span class="line"> |      |     |           UART_RX |      |   |    |       | 18 || 38 |       |    | 0 | ALT0 | I2S0_LRCK_RX/GPIO3_D1      | 16  |  121 |</span><br><span class="line"> |      |     |           UART_TX |      |   |    |       | 19 || 39 |       |    |   |      | MCU_PA1                    |     |      |</span><br><span class="line"> |      |     |              3.3V |      |   |    |       | 20 || 40 |       |    |   |      | GND(0V)                    |     |      |</span><br><span class="line"> +------+-----+-------------------+------+---+----+-------+----++----+-------+----+---+------+----------------------------+-----+------+</span><br></pre></td></tr></table></figure>

<p>Select the GPIO you need to use, and confirm the corresponding physical pin and GPIO value. Taking GPIOH6 as an example here, the corresponding GPIO value is 112, and the physical pin is pin 13.</p>
<ul>
<li>export GPIO</li>
</ul>
<p>Export the selected GPIO to operate the GPIO,</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@Khadas:/home/khadas# echo 112 &gt; /sys/class/gpio/export</span><br></pre></td></tr></table></figure>

<h2 id="Compile-GPIO-test-program" class="article-heading"><a href="#Compile-GPIO-test-program" class="headerlink" title="Compile GPIO test program"></a>Compile GPIO test program<a class="article-anchor" href="#Compile-GPIO-test-program" aria-hidden="true"></a></h2><ul>
<li>source code for <code>gpio-irq.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;poll.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>	SYSFS_GPIO_DIR	<span class="meta-string">&quot;/sys/class/gpio&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>	MAX_BUF		255</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gpio_export</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> gpio)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fd, len;</span><br><span class="line">	<span class="keyword">char</span> buf[MAX_BUF];</span><br><span class="line"></span><br><span class="line">	fd = open(SYSFS_GPIO_DIR <span class="string">&quot;/export&quot;</span>, O_WRONLY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Can&#x27;t export GPIO %d pin: %s\n&quot;</span>, gpio, strerror(errno));</span><br><span class="line">		<span class="keyword">return</span> fd;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	len = <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%d&quot;</span>, gpio);</span><br><span class="line">	write(fd, buf, len);</span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gpio_unexport</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> gpio)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fd, len;</span><br><span class="line">	<span class="keyword">char</span> buf[MAX_BUF];</span><br><span class="line"></span><br><span class="line">	fd = open(SYSFS_GPIO_DIR <span class="string">&quot;/unexport&quot;</span>, O_WRONLY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Can&#x27;t unexport GPIO %d pin: %s\n&quot;</span>, gpio, strerror(errno));</span><br><span class="line">		<span class="keyword">return</span> fd;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	len = <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%d&quot;</span>, gpio);</span><br><span class="line">	write(fd, buf, len);</span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gpio_set_edge</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> gpio, <span class="keyword">char</span> *edge)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fd, len;</span><br><span class="line">	<span class="keyword">char</span> buf[MAX_BUF];</span><br><span class="line"></span><br><span class="line">	len = <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), SYSFS_GPIO_DIR <span class="string">&quot;/gpio%d/edge&quot;</span>, gpio);</span><br><span class="line"></span><br><span class="line">	fd = open(buf, O_WRONLY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Can&#x27;t set GPIO %d pin edge: %s\n&quot;</span>, gpio, strerror(errno));</span><br><span class="line">		<span class="keyword">return</span> fd;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	write(fd, edge, <span class="built_in">strlen</span>(edge)+<span class="number">1</span>);</span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gpio_set_pull</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> gpio, <span class="keyword">char</span> *pull)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> fd, len;</span><br><span class="line">	<span class="keyword">char</span> buf[MAX_BUF];</span><br><span class="line"></span><br><span class="line">	len = <span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), SYSFS_GPIO_DIR <span class="string">&quot;/gpio%d/pull&quot;</span>, gpio);</span><br><span class="line"></span><br><span class="line">	fd = open(buf, O_WRONLY);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Can&#x27;t set GPIO %d pin pull: %s\n&quot;</span>, gpio, strerror(errno));</span><br><span class="line">		<span class="keyword">return</span> fd;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	write(fd, pull, <span class="built_in">strlen</span>(pull)+<span class="number">1</span>);</span><br><span class="line">	close(fd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pollfd</span> <span class="title">fdset</span>[2];</span></span><br><span class="line">	<span class="keyword">int</span> fd, ret, gpio;</span><br><span class="line">	<span class="keyword">char</span> buf[MAX_BUF];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argc &lt; <span class="number">3</span> || argc &gt; <span class="number">4</span>)	&#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;usage : sudo sysfs_irq_test &lt;gpio&gt; &lt;edge&gt; [pull]\n&quot;</span>);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="keyword">return</span>	<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	gpio = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">if</span> (gpio_export(gpio))	&#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;error : export %d\n&quot;</span>, gpio);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="keyword">return</span>	<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (gpio_set_edge(gpio, argv[<span class="number">2</span>])) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;error : edge %s\n&quot;</span>, argv[<span class="number">2</span>]);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="keyword">return</span>	<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (argv[<span class="number">3</span>] &amp;&amp; gpio_set_pull(gpio, argv[<span class="number">3</span>])) &#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;error : pull %s\n&quot;</span>, argv[<span class="number">3</span>]);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="keyword">return</span>	<span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">snprintf</span>(buf, <span class="keyword">sizeof</span>(buf), SYSFS_GPIO_DIR <span class="string">&quot;/gpio%d/value&quot;</span>, gpio);</span><br><span class="line">	fd = open(buf, O_RDWR);</span><br><span class="line">	<span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">goto</span> out;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">		<span class="built_in">memset</span>(fdset, <span class="number">0</span>, <span class="keyword">sizeof</span>(fdset));</span><br><span class="line">		fdset[<span class="number">0</span>].fd = STDIN_FILENO;</span><br><span class="line">		fdset[<span class="number">0</span>].events = POLLIN;</span><br><span class="line">		fdset[<span class="number">1</span>].fd = fd;</span><br><span class="line">		fdset[<span class="number">1</span>].events = POLLPRI;</span><br><span class="line">		ret = poll(fdset, <span class="number">2</span>, <span class="number">3</span>*<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			perror(<span class="string">&quot;poll&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (fdset[<span class="number">1</span>].revents &amp; POLLPRI) &#123;</span><br><span class="line">			<span class="keyword">char</span> c;</span><br><span class="line">			(<span class="keyword">void</span>)read (fd, &amp;c, <span class="number">1</span>) ;</span><br><span class="line">			lseek (fd, <span class="number">0</span>, SEEK_SET) ;</span><br><span class="line">			<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;\nGPIO %d interrupt occurred!\n&quot;</span>, gpio);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (fdset[<span class="number">0</span>].revents &amp; POLLIN)</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	close(fd);</span><br><span class="line">out:</span><br><span class="line">	<span class="keyword">if</span> (gpio_unexport(gpio))	&#123;</span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">&quot;error : unexport %d\n&quot;</span>, gpio);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@Khadas:/home/khadas# gcc -o gpio-irq gpio-irq.c</span><br></pre></td></tr></table></figure>
<h2 id="Compile-the-source-code" class="article-heading"><a href="#Compile-the-source-code" class="headerlink" title="Compile the source code"></a>Compile the source code<a class="article-anchor" href="#Compile-the-source-code" aria-hidden="true"></a></h2><ul>
<li>run</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./gpio-irq 112 rising down</span><br><span class="line">.</span><br><span class="line">GPIO 112 interrupt occurred!</span><br><span class="line">..........</span><br></pre></td></tr></table></figure>

<p>Connect the Pin40 and pin13 of the physical pin through the DuPont line to trigger the interrupt. The phenomenon is as follows:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@Khadas:/home/khadas# ./gpio-irq 112 rising</span><br><span class="line">.</span><br><span class="line">GPIO 112 interrupt occurred!</span><br><span class="line">..</span><br><span class="line">GPIO 112 interrupt occurred!</span><br><span class="line">.</span><br><span class="line">GPIO 112 interrupt occurred!</span><br><span class="line">.</span><br><span class="line">GPIO 112 interrupt occurred!</span><br></pre></td></tr></table></figure>
<ul>
<li>Test procedure description</li>
</ul>
<p>The running format is as follows:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@Khadas:/home/khadas# ./gpio-irq &lt;edge&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;edge&gt;</code> can be set to <code>rising</code> or <code>failing</code>.</p>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2021-07-28T10:17:22.975Z" itemprop="dateModified">Last updated: 2021-07-28</time>
                <a href="index.html" class="article-footer-next" title="Quick Setup"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <div class="article-toc-border">
                <strong class="sidebar-title">Contents</strong>
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Switch-to-root-user"><span class="toc-text" title="Switch to root user">Switch to root user</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GPIO-Pin-Control-Setting"><span class="toc-text" title="GPIO Pin Control Setting">GPIO Pin Control Setting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compile-GPIO-test-program"><span class="toc-text" title="Compile GPIO test program">Compile GPIO test program</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compile-the-source-code"><span class="toc-text" title="Compile the source code">Compile the source code</span></a></li></ol>
                <a href="#" id="article-toc-top">Back to Top</a>
              </div>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner">
    <strong class="sidebar-title"><details><summary>Quick Start</summary><a href="index.html" class="sidebar-link first">Quick Setup</a><a href="OsIntroduce.html" class="sidebar-link">OS Introduce</a><a href="InstallOsIntoEmmc.html" class="sidebar-link">Install OS into eMMC</a><a href="InstallOsIntoSdusb.html" class="sidebar-link">Install OS into SD/USB Media</a><a href="BootIntoUpgradeMode.html" class="sidebar-link">Boot into Upgrade Mode</a><a href="Hardware.html" class="sidebar-link">Edge Hardware</a></details></strong><strong class="sidebar-title"><details><summary>Configuration</summary><strong class="sidebar-link"><details><summary>Basic</summary><a href="UpgradeSystem.html" class="sidebar-link secondary-first">Upgrade System</a><a href="SystemConfigFile.html" class="sidebar-link">Config File</a><a href="AutoLogin.html" class="sidebar-link">Auto Login</a><a href="WriteSDImageToEmmc.html" class="sidebar-link">Write SD Image to eMMC</a><a href="DeviceTreeOverlay.html" class="sidebar-link">Device Tree Overlay</a></details></strong><strong class="sidebar-link"><details><summary>Network</summary><a href="Wifi.html" class="sidebar-link secondary-first">Wi-Fi</a><a href="Bluetooth.html" class="sidebar-link">Bluetooth</a><a href="Wol.html" class="sidebar-link">Wake On Lan</a></details></strong><strong class="sidebar-link"><details><summary>Display</summary><a href="UbuntuLogo.html" class="sidebar-link secondary-first">Ubuntu Logo</a><a href="SetupFramebufferConsoleFont.html" class="sidebar-link">Framebuffer Console Font</a></details></strong><strong class="sidebar-link"><details><summary>Accessories</summary><a href="Fan.html" class="sidebar-link secondary-first">Cooling Fan</a><a href="TS050.html" class="sidebar-link">TS050 Touch Screen</a><a href="LteModule.html" class="sidebar-link">LTE 4G Module</a></details></strong></details></strong><strong class="sidebar-title"><details open><summary>Applications</summary><strong class="sidebar-link"><details open><summary>GPIO</summary><a href="Gpio.html" class="sidebar-link secondary-first">GPIO</a><a href="GpioIRQ.html" class="sidebar-link current">IRQ</a><a href="LED.html" class="sidebar-link">LED</a><a href="1wire.html" class="sidebar-link">1-Wire</a><a href="WiringPi.html" class="sidebar-link">WiringPi</a><a href="WiringPi-Python.html" class="sidebar-link">WiringPi-Python</a></details></strong><a href="PlayVideo.html" class="sidebar-link first">Play Video</a><a href="Docker.html" class="sidebar-link">Docker</a><a href="32bitLibrary.html" class="sidebar-link">32-bit Library</a></details></strong><strong class="sidebar-title"><details><summary>Development</summary><strong class="sidebar-link"><details><summary>U-Boot</summary><a href="BuildUboot.html" class="sidebar-link secondary-first">Build U-Boot</a><a href="UpgradeUboot.html" class="sidebar-link">Upgrade U-Boot</a><a href="BootFromSpiFlash.html" class="sidebar-link">Boot From SPI-Flash</a><a href="KbiGuidance.html" class="sidebar-link">KBI Guide</a></details></strong><strong class="sidebar-link"><details><summary>Linux</summary><a href="BuildLinuxKernel.html" class="sidebar-link secondary-first">Build Linux Kernel</a><a href="UpgradeLinuxKernel.html" class="sidebar-link">Upgrade Linux Kernel</a></details></strong><a href="FenixScript.html" class="sidebar-link first">Build Ubuntu/Debian Image</a><a href="SetupSerialTool.html" class="sidebar-link">Setup Serial Debug Tool</a></details></strong>
  </div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapperforfooter">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2021 <a href="https://www.khadas.com/" rel="external nofollow noreferrer" target="_blank">Khadas</a><br>
    </div>
    <div id="footer-links">
      <a href="https://facebook.com/khadas.official" rel="external nofollow noreferrer" class="footer-link" target="_blank"><i class="fa fa-facebook"></i></a>
      <a href="https://twitter.com/khadas_official" rel="external nofollow noreferrer" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="https://youtube.com/c/khadas" rel="external nofollow noreferrer" class="footer-link" target="_blank"><i class="fa fa-youtube-play"></i></a>
      <a href="https://github.com/khadas" rel="external nofollow noreferrer" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <strong class="mobile-nav-link  header"><details ><summary>VIM</summary><a href="/linux/vim1/" class="mobile-nav-link secondary ">VIM1</a><a href="/linux/vim2/" class="mobile-nav-link secondary ">VIM2</a><a href="/linux/vim3/" class="mobile-nav-link secondary ">VIM3</a></details></strong><a href="/linux/edge/" class="mobile-nav-link current header">Edge</a><a href="/linux/tone1/" class="mobile-nav-link  header">Tone1</a><a href="/linux/hardware/hardwareEdge" class="mobile-nav-link  header">Hardware</a><a href="/linux/firmware/EdgeUbuntuFirmware" class="mobile-nav-link  header">Firmware</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/khadas" class="mobile-nav-link header" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <strong class="mobile-nav-title"><details><summary>Quick Start</summary><a href="index.html" class="mobile-nav-link first">Quick Setup</a><a href="OsIntroduce.html" class="mobile-nav-link">OS Introduce</a><a href="InstallOsIntoEmmc.html" class="mobile-nav-link">Install OS into eMMC</a><a href="InstallOsIntoSdusb.html" class="mobile-nav-link">Install OS into SD/USB Media</a><a href="BootIntoUpgradeMode.html" class="mobile-nav-link">Boot into Upgrade Mode</a><a href="Hardware.html" class="mobile-nav-link">Edge Hardware</a></details></strong><strong class="mobile-nav-title"><details><summary>Configuration</summary><strong class="mobile-nav-link"><details><summary>Basic</summary><a href="UpgradeSystem.html" class="mobile-nav-link secondary-first">Upgrade System</a><a href="SystemConfigFile.html" class="mobile-nav-link">Config File</a><a href="AutoLogin.html" class="mobile-nav-link">Auto Login</a><a href="WriteSDImageToEmmc.html" class="mobile-nav-link">Write SD Image to eMMC</a><a href="DeviceTreeOverlay.html" class="mobile-nav-link">Device Tree Overlay</a></details></strong><strong class="mobile-nav-link"><details><summary>Network</summary><a href="Wifi.html" class="mobile-nav-link secondary-first">Wi-Fi</a><a href="Bluetooth.html" class="mobile-nav-link">Bluetooth</a><a href="Wol.html" class="mobile-nav-link">Wake On Lan</a></details></strong><strong class="mobile-nav-link"><details><summary>Display</summary><a href="UbuntuLogo.html" class="mobile-nav-link secondary-first">Ubuntu Logo</a><a href="SetupFramebufferConsoleFont.html" class="mobile-nav-link">Framebuffer Console Font</a></details></strong><strong class="mobile-nav-link"><details><summary>Accessories</summary><a href="Fan.html" class="mobile-nav-link secondary-first">Cooling Fan</a><a href="TS050.html" class="mobile-nav-link">TS050 Touch Screen</a><a href="LteModule.html" class="mobile-nav-link">LTE 4G Module</a></details></strong></details></strong><strong class="mobile-nav-title"><details open><summary>Applications</summary><strong class="mobile-nav-link"><details open><summary>GPIO</summary><a href="Gpio.html" class="mobile-nav-link secondary-first">GPIO</a><a href="GpioIRQ.html" class="mobile-nav-link current">IRQ</a><a href="LED.html" class="mobile-nav-link">LED</a><a href="1wire.html" class="mobile-nav-link">1-Wire</a><a href="WiringPi.html" class="mobile-nav-link">WiringPi</a><a href="WiringPi-Python.html" class="mobile-nav-link">WiringPi-Python</a></details></strong><a href="PlayVideo.html" class="mobile-nav-link first">Play Video</a><a href="Docker.html" class="mobile-nav-link">Docker</a><a href="32bitLibrary.html" class="mobile-nav-link">32-bit Library</a></details></strong><strong class="mobile-nav-title"><details><summary>Development</summary><strong class="mobile-nav-link"><details><summary>U-Boot</summary><a href="BuildUboot.html" class="mobile-nav-link secondary-first">Build U-Boot</a><a href="UpgradeUboot.html" class="mobile-nav-link">Upgrade U-Boot</a><a href="BootFromSpiFlash.html" class="mobile-nav-link">Boot From SPI-Flash</a><a href="KbiGuidance.html" class="mobile-nav-link">KBI Guide</a></details></strong><strong class="mobile-nav-link"><details><summary>Linux</summary><a href="BuildLinuxKernel.html" class="mobile-nav-link secondary-first">Build Linux Kernel</a><a href="UpgradeLinuxKernel.html" class="mobile-nav-link">Upgrade Linux Kernel</a></details></strong><a href="FenixScript.html" class="mobile-nav-link first">Build Ubuntu/Debian Image</a><a href="SetupSerialTool.html" class="mobile-nav-link">Setup Serial Debug Tool</a></details></strong>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="edge/GpioIRQ.html">
      
        <option value="en" selected>English</option>
      
        <option value="zh-cn">简体中文</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->

<script src="/linux/js/lang_select.js"></script>


<script src="/linux/js/toc.js"></script>


<script src="/linux/js/mobile_nav.js"></script>

<!-- endbuild -->

<!-- Algolia -->


</body>
</html>
